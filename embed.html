<!DOCTYPE html>
<html>
<head>
    <title>YouTube Player Proxy</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: black;
            font-family: Consolas, monospace;
            color: lime;
        }
        #player {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        #debug {
            position: absolute;
            top: 5px;
            left: 5px;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid lime;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none; /* Rende il div non cliccabile */
        }
    </style>
</head>
<body>
    <!-- Area per il player -->
    <div id="player"></div>
    <!-- Area per i messaggi di debug -->
    <div id="debug">Inizializzazione...</div>

    <script>
        const debugDiv = document.getElementById('debug');
        function log(message) {
            console.log(message);
            debugDiv.innerHTML += `<br>${message}`;
        }

        // 1. Caricamento asincrono dell'API IFrame Player
        log('Caricamento API YouTube...');
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player;

        // 2. Funzione chiamata automaticamente quando l'API è pronta
        function onYouTubeIframeAPIReady() {
            log('API YouTube pronta.');
            
            function getQueryParam(param) {
                var href = window.location.href;
                var reg = new RegExp('[?&]' + param + '=([^&#]*)', 'i');
                var string = reg.exec(href);
                return string ? string[1] : null;
            }

            const videoId = getQueryParam('videoId');

            if (videoId) {
                log(`ID Video trovato: ${videoId}`);
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: {
                        'autoplay': 1,
                        'controls': 1,
                        'enablejsapi': 1,
                        'modestbranding': 1,
                        'rel': 0,
                        'iv_load_policy': 3,
                        'mute': 1 /* MODIFICA CHIAVE: Aggiunto per abilitare l'autoplay */
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onError': onPlayerError
                    }
                });
            } else {
                log('ERRORE: ID Video non trovato nell\'URL.');
            }
        }

        // 3. Funzione chiamata quando il player è pronto
        function onPlayerReady(event) {
            log('Player pronto. Avvio riproduzione...');
            event.target.playVideo();
        }
        
        // 4. Funzione chiamata in caso di errore del player
        function onPlayerError(event) {
            log(`ERRORE PLAYER: Codice ${event.data}`);
        }
    </script>
</body>
</html>
